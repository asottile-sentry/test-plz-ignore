on:
  pull_request_target:
    types: [labeled, opened, reopened, synchronize]

# disable special privileges
permissions:
  # needed for `actions/checkout` to clone the code
  contents: read
  # needed to remove the label
  pull-requests: write

jobs:
  main:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: check permissions
      id: permissions
      run: python3 -uS .github/workflows/prt/check-permissions ${{ github.event.repository.id }} ${{ github.event.pull_request.user.login }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    - run: jq . <<< "$EVENT"
      env:
        EVENT: ${{ toJSON(github.event) }}
    - name: sensitive step
      run: echo you pass go!
      if: steps.permissions.outputs.has-permission == 'true'
      env:
        BECAUSE_PERMISSION: ${{ steps.permissions.outputs.has-permissions }}
